paths:
    - ./src
formatters:
    graphviz:
        groups:
            Application:
                - Application
                - Application Infrastructure Interfaces
                - Application Command
                - Application Command Handlers
                - Application Query
                - Application Model
                - Application Query Result
            Infrastructure:
                - Infrastructure
                - Infrastructure Calendar
                - Time
            Domain:
                - Domain Objects
                - Domain Services
                - Domain Specifications
                - Domain Infrastructure Interfaces
            Interactions:
                - Interactions
            Framework:
                - Symfony
layers:
    # CONSTRAINTS
    -
        # Make DateTime a separate layer to ensure that only Infrastructure Calendar has access to it.
        # It gives us ability to change time when testing with predictable results
        name: Time
        collectors:
            - type: bool
              must:
                  -
                      type: className
                      regex: DateTime
                  -
                      type: className
                      regex: DateTimeImmutable
    -
        # Forbid using UUID other than V4 (random) unless explicitly allowed
        name: NonV4TypeUuid
        collectors:
            - type: bool
              must:
                - type: className
                  regex: Symfony\\Component\\Uid\\Uuid.*
              must_not:
                - type: className
                  regex: Symfony\\Component\\Uid\\UuidV4
    -
        # Limit references to framework to ensure that Application and Domain do not depend on it leaving it to Interactions and Infrastructure
        name: Symfony
        collectors:
            - type: bool
              must:
                  - type: className
                    regex: Symfony\\.*
              must_not:
                  - type: className
                    regex: Symfony\\Component\\Uid\\.*
                  - type: className
                    regex: Symfony\\Component\\Messenger\\Envelope
                  - type: className
                    regex: Symfony\\Component\\Messenger\\Stamp\\StampInterface

    # UI
    -
        name: Interactions
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Interactions\\.*

    # APPLICATION
    -
        name: Application
        collectors:
            - type: bool
              must:
                  - type: className
                    regex: Enraged\\Xenomorph\\Application\\.*
              must_not:
                  - type: className
                    regex: Enraged\\Xenomorph\\Application\\Command\\.*Command
                  - type: className
                    regex: Enraged\\Xenomorph\\Application\\CommandHandler\\.*Handler
                  - type: className
                    regex: Enraged\\Xenomorph\\Application\\Query\\.*Query
                  - type: className
                    regex: Enraged\\Xenomorph\\Application\\Query\\.*Model
                  - type: className
                    regex: Enraged\\Xenomorph\\Application\\QueryResult\\.*Result
                  - type: className
                    regex: Enraged\\Xenomorph\\Application\\Infrastructure\\.*Interface
    -
        name: Application Infrastructure Interfaces
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\Infrastructure\\.*Interface
    -
        name: Application Command
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\Command\\.*Command
    -
        name: Application Command Handlers
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\CommandHandler\\.*Handler
    -
        name: Application Query
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\Query\\.*Query
    -
        name: Application Model
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\Query\\.*Model
    -
        name: Application Query Result
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\QueryResult\\.*Result

    # INFRASTRUCTURE
    -
        name: Infrastructure
        collectors:
            - type: bool
              must:
                - type: className
                  regex: Enraged\\Xenomorph\\Infrastructure\\.*
              must_not:
                - type: className
                  regex: Enraged\\Xenomorph\\Infrastructure\\Calendar\\.*
    -
        name: Infrastructure Calendar
        collectors:
            - type: bool
              must:
                  - type: className
                    regex: Enraged\\Xenomorph\\Infrastructure\\Calendar\\.*

    # DOMAIN
    -
        name: Domain Objects
        collectors:
            - type: bool
              must:
                  - type: className
                    regex: Enraged\\Xenomorph\\Domain\\.*
              must_not:
                  - type: className
                    regex: Enraged\\Xenomorph\\Domain\\.*Interface
                  - type: className
                    regex: Enraged\\Xenomorph\\Domain\\.*Specification
                  - type: className
                    regex: Enraged\\Xenomorph\\Domain\\.*Service
    -
        name: Domain Infrastructure Interfaces
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\Domain\\.*Interface
    -
        name: Domain Services
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\Domain\\.*Service
    -
        name: Domain Specifications
        collectors:
            - type: className
              regex: Enraged\\Xenomorph\\Application\\Domain\\.*Specification
ruleset:
    # UI
    Interactions:
        - Application Command
        - Application Query
        - Application Model
        - Application Query Result
        - Application Infrastructure Interfaces
        - Symfony

    # APPLICATION
    Application:
        - Application Command
        - Application Query
        - Application Query Result
        - Application Model
        - Application Infrastructure Interfaces
    Application Infrastructure Interfaces:
        - Application Model
    Application Command:
    Application Command Handlers:
        - Application Infrastructure Interfaces
        - Application Command
        - Application Query
        - Application Model
        - Application Query Result
        - Domain Infrastructure Interfaces
        - Domain Objects
        - Domain Specifications
        - Domain Services
    Application Query:
    Application Model:
    Application Query Result:
        - Application Query
        - Application Model
        - Application Infrastructure Interfaces

    # Infrastructure
    Infrastructure:
        - Infrastructure Calendar
        - Application Infrastructure Interfaces
        - Application Query
        - Application Model
        - Domain Objects
        - Domain Infrastructure Interfaces
        - Symfony
    Infrastructure Calendar:
        - Application Infrastructure Interfaces
        - Domain Infrastructure Interfaces
        - Infrastructure
        - Time

    # DOMAIN
    Domain Objects:
        - Domain Infrastructure Interfaces
        - Domain Specifications
    Domain Infrastructure Interfaces:
        - Domain Objects
    Domain Specifications:
        - Domain Objects
        - Domain Infrastructure Interfaces
    Domain Services:
        - Domain Objects
        - Domain Infrastructure Interfaces
        - Domain Specifications
